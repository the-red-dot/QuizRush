<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>××™×¨×•×¥ ×”×™×“×¢ - Trivia Rush</title>
Â  Â  <!-- ×™×™×‘×•× ×’×•×¤× ×™× -->
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&family=Rubik+Glitch&display=swap" rel="stylesheet">
Â  Â  <!-- ××™×™×§×•× ×™× -->
Â  Â  <script src="https://unpkg.com/lucide@latest"></script>
Â  Â  <!-- ××¤×§×˜ ×§×•× ×¤×˜×™ -->
Â  Â  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary: #7000ff;
Â  Â  Â  Â  Â  Â  --secondary: #00f0ff;
Â  Â  Â  Â  Â  Â  --success: #00ff9d;
Â  Â  Â  Â  Â  Â  --danger: #ff0055;
Â  Â  Â  Â  Â  Â  --warning: #ffcc00;
Â  Â  Â  Â  Â  Â  --shop: #ff00cc;
Â  Â  Â  Â  Â  Â  --bg-dark: #0a0a12;
Â  Â  Â  Â  Â  Â  --bg-card: #161625;
Â  Â  Â  Â  Â  Â  --text-main: #ffffff;
Â  Â  Â  Â  Â  Â  --text-muted: #a0a0b0;
Â  Â  Â  Â  }

Â  Â  Â  Â  * {
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  Â  Â  -webkit-tap-highlight-color: transparent;
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  font-family: 'Heebo', sans-serif;
Â  Â  Â  Â  Â  Â  background-color: var(--bg-dark);
Â  Â  Â  Â  Â  Â  color: var(--text-main);
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  background-image: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #000000 100%);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ×× ×™××¦×™×•×ª */
Â  Â  Â  Â  @keyframes pulse-glow {
Â  Â  Â  Â  Â  Â  0% { text-shadow: 0 0 10px var(--primary); transform: scale(1); }
Â  Â  Â  Â  Â  Â  50% { text-shadow: 0 0 25px var(--secondary), 0 0 10px white; transform: scale(1.02); }
Â  Â  Â  Â  Â  Â  100% { text-shadow: 0 0 10px var(--primary); transform: scale(1); }
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes float-up {
Â  Â  Â  Â  Â  Â  0% { transform: translateY(0) scale(1); opacity: 1; }
Â  Â  Â  Â  Â  Â  100% { transform: translateY(-50px) scale(1.2); opacity: 0; }
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes float-center {
Â  Â  Â  Â  Â  Â  0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
Â  Â  Â  Â  Â  Â  20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
Â  Â  Â  Â  Â  Â  80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
Â  Â  Â  Â  Â  Â  100% { transform: translate(-50%, -80%) scale(1.5); opacity: 0; }
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes slideIn {
Â  Â  Â  Â  Â  Â  from { transform: translateY(50px); opacity: 0; }
Â  Â  Â  Â  Â  Â  to { transform: translateY(0); opacity: 1; }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  @keyframes popIn {
Â  Â  Â  Â  Â  Â  0% { transform: scale(0); opacity: 0; }
Â  Â  Â  Â  Â  Â  80% { transform: scale(1.1); opacity: 1; }
Â  Â  Â  Â  Â  Â  100% { transform: scale(1); opacity: 1; }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ×¨×›×™×‘×™ UI ×›×œ×œ×™×™× */
Â  Â  Â  Â  .screen {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 600px;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  }

Â  Â  Â  Â  .screen.active {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, var(--primary), #4c00b0);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  padding: 15px 30px;
Â  Â  Â  Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(112, 0, 255, 0.4);
Â  Â  Â  Â  Â  Â  margin: 10px 0;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn:active {
Â  Â  Â  Â  Â  Â  transform: scale(0.95);
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn:disabled {
Â  Â  Â  Â  Â  Â  filter: grayscale(1);
Â  Â  Â  Â  Â  Â  opacity: 0.5;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-outline {
Â  Â  Â  Â  Â  Â  background: transparent;
Â  Â  Â  Â  Â  Â  border: 2px solid var(--secondary);
Â  Â  Â  Â  Â  Â  color: var(--secondary);
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 10px rgba(0, 240, 255, 0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-shop {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #ff00cc, #990066);
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(255, 0, 204, 0.4);
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.2);
Â  Â  Â  Â  }

Â  Â  Â  Â  .name-input {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  Â  Â  border: 2px solid var(--primary);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  width: 80%;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-family: 'Heebo', sans-serif;
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  Â  Â  transition: all 0.3s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .name-input:focus {
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 15px var(--primary);
Â  Â  Â  Â  Â  Â  border-color: var(--secondary);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ××¡×š ×¤×ª×™×—×” */
Â  Â  Â  Â  #menu-screen {
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .game-title {
Â  Â  Â  Â  Â  Â  font-family: 'Rubik Glitch', sans-serif;
Â  Â  Â  Â  Â  Â  font-size: 4rem;
Â  Â  Â  Â  Â  Â  color: var(--secondary);
Â  Â  Â  Â  Â  Â  text-shadow: 0 0 20px var(--primary);
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  animation: pulse-glow 2s ease-in-out infinite alternate;
Â  Â  Â  Â  Â  Â  line-height: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  .subtitle {
Â  Â  Â  Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  Â  Â  Â  color: var(--text-muted);
Â  Â  Â  Â  Â  Â  margin-bottom: 40px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ××¡×š ××©×—×§ */
Â  Â  Â  Â  #game-screen {
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  }

Â  Â  Â  Â  .hud {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  background: rgba(22, 22, 37, 0.9);
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .stat-box {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }

Â  Â  Â  Â  .stat-label { font-size: 0.7rem; color: var(--text-muted); }
Â  Â  Â  Â  .stat-value { font-size: 1.2rem; font-weight: bold; font-family: monospace; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .timer-container {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 8px;
Â  Â  Â  Â  Â  Â  background: #333;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  margin-top: 5px;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }

Â  Â  Â  Â  .timer-bar {
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background: var(--success);
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  transition: width 0.1s linear, background-color 0.3s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .timer-bar.danger { background: var(--danger); animation: pulse-red 0.5s infinite; }

Â  Â  Â  Â  @keyframes pulse-red {
Â  Â  Â  Â  Â  Â  0% { opacity: 1; }
Â  Â  Â  Â  Â  Â  50% { opacity: 0.7; }
Â  Â  Â  Â  Â  Â  100% { opacity: 1; }
Â  Â  Â  Â  }

Â  Â  Â  Â  .progress-text {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  Â  Â  Â  color: var(--text-muted);
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .question-card {
Â  Â  Â  Â  Â  Â  background: var(--bg-card);
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(112, 0, 255, 0.2);
Â  Â  Â  Â  Â  Â  animation: slideIn 0.5s ease-out;
Â  Â  Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .question-text {
Â  Â  Â  Â  Â  Â  font-size: 1.3rem;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  line-height: 1.3;
Â  Â  Â  Â  }

Â  Â  Â  Â  .options-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr 1fr;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .option-btn {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.05);
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 1rem;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  Â  Â  text-align: right;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }

Â  Â  Â  Â  .option-btn:hover:not(:disabled) {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  Â  Â  border-color: var(--primary);
Â  Â  Â  Â  }

Â  Â  Â  Â  .option-btn.correct {
Â  Â  Â  Â  Â  Â  background: rgba(0, 255, 157, 0.2);
Â  Â  Â  Â  Â  Â  border-color: var(--success);
Â  Â  Â  Â  Â  Â  color: var(--success);
Â  Â  Â  Â  }

Â  Â  Â  Â  .option-btn.wrong {
Â  Â  Â  Â  Â  Â  background: rgba(255, 0, 85, 0.2);
Â  Â  Â  Â  Â  Â  border-color: var(--danger);
Â  Â  Â  Â  Â  Â  color: var(--danger);
Â  Â  Â  Â  }

Â  Â  Â  Â  .bottom-controls {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .lifelines {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: flex-start;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .lifeline-btn {
Â  Â  Â  Â  Â  Â  background: #2a2a3d;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  width: 50px;
Â  Â  Â  Â  Â  Â  height: 50px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
Â  Â  Â  Â  }

Â  Â  Â  Â  .lifeline-btn:hover:not(:disabled) { transform: translateY(-3px); background: #3a3a4d; }
Â  Â  Â  Â  .lifeline-btn:disabled { opacity: 0.3; cursor: not-allowed; }
Â  Â  Â  Â  .lifeline-badge {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: -5px; right: -5px;
Â  Â  Â  Â  Â  Â  background: var(--danger);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 0.7rem;
Â  Â  Â  Â  Â  Â  width: 18px; height: 18px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Shop Modal specific styles */
Â  Â  Â  Â  .shop-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  Â  Â  Â  gap: 15px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .shop-item {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.05);
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  transition: 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .shop-item:hover { border-color: var(--shop); background: rgba(255, 0, 204, 0.1); }

Â  Â  Â  Â  .shop-item-details { text-align: right; }
Â  Â  Â  Â  .shop-item-title { font-weight: bold; font-size: 1.1rem; }
Â  Â  Â  Â  .shop-item-desc { font-size: 0.8rem; color: var(--text-muted); }
Â  Â  Â  Â  .shop-item-price { font-family: monospace; font-weight: bold; color: var(--warning); font-size: 1.2rem; }

Â  Â  Â  Â  /* ××¡×š ×˜×¢×™× ×” */
Â  Â  Â  Â  #loading-screen {
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.95);
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  z-index: 100;
Â  Â  Â  Â  }

Â  Â  Â  Â  .loader {
Â  Â  Â  Â  Â  Â  width: 60px;
Â  Â  Â  Â  Â  Â  height: 60px;
Â  Â  Â  Â  Â  Â  border: 5px solid var(--primary);
Â  Â  Â  Â  Â  Â  border-bottom-color: transparent;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  animation: rotation 1s linear infinite;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes rotation {
Â  Â  Â  Â  Â  Â  0% { transform: rotate(0deg); }
Â  Â  Â  Â  Â  Â  100% { transform: rotate(360deg); }
Â  Â  Â  Â  }

Â  Â  Â  Â  .loading-text {
Â  Â  Â  Â  Â  Â  font-size: 1.5rem;
Â  Â  Â  Â  Â  Â  color: var(--secondary);
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .loading-tip {
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  Â  Â  Â  color: var(--text-muted);
Â  Â  Â  Â  Â  Â  max-width: 80%;
Â  Â  Â  Â  Â  Â  margin: 0 auto;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ××¡×š ×¡×™×•× */
Â  Â  Â  Â  #gameover-screen {
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .stat-row {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid rgba(255,255,255,0.1);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* AI Thinking Bubble */
Â  Â  Â  Â  .ai-thinking {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  bottom: 90px;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  Â  Â  Â  background: rgba(20, 20, 40, 0.95);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--secondary);
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  color: #fff;
Â  Â  Â  Â  Â  Â  font-size: 0.95rem;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  z-index: 20;
Â  Â  Â  Â  Â  Â  max-width: 90%;
Â  Â  Â  Â  Â  Â  text-align: right;
Â  Â  Â  Â  Â  Â  box-shadow: 0 5px 20px rgba(0,0,0,0.5);
Â  Â  Â  Â  Â  Â  line-height: 1.5;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Modals */
Â  Â  Â  Â  .modal-overlay {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.85);
Â  Â  Â  Â  Â  Â  z-index: 200;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(5px);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .modal-overlay.active { display: flex; animation: popIn 0.3s ease-out; }

Â  Â  Â  Â  .modal-content {
Â  Â  Â  Â  Â  Â  background: var(--bg-card);
Â  Â  Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  Â  Â  max-width: 500px;
Â  Â  Â  Â  Â  Â  max-height: 80vh;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  border: 1px solid var(--primary);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 50px rgba(112, 0, 255, 0.3);
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-header {
Â  Â  Â  Â  Â  Â  background: linear-gradient(90deg, #2a0050, #1a1a2e);
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-size: 1.5rem;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: var(--secondary);
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid rgba(255,255,255,0.1);
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-back-btn {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  left: 15px;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  transform: translateY(-50%);
Â  Â  Â  Â  Â  Â  background: none;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-body {
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-footer {
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-top: 1px solid rgba(255,255,255,0.1);
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .achievement-item {
Â  Â  Â  Â  Â  Â  background: rgba(255,255,255,0.05);
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  opacity: 0.5; /* Locked state */
Â  Â  Â  Â  }

Â  Â  Â  Â  .achievement-item.unlocked {
Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  Â  Â  background: linear-gradient(90deg, rgba(112, 0, 255, 0.2), transparent);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--primary);
Â  Â  Â  Â  }

Â  Â  Â  Â  .achievement-icon { font-size: 1.5rem; }

Â  Â  Â  Â  .leaderboard-item {
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  justify-content: space-between;Â 
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #333;Â 
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: background 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .leaderboard-item:hover { background: rgba(255,255,255,0.05); }

Â  Â  Â  Â  /* Floating Text Specifics */
Â  Â  Â  Â  .float-text {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  z-index: 100;
Â  Â  Â  Â  Â  Â  white-space: nowrap;
Â  Â  Â  Â  Â  Â  text-shadow: 0 0 5px rgba(0,0,0,0.8);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .float-up { animation: float-up 1s ease-out forwards; }
Â  Â  Â  Â  .float-center { animation: float-center 2s ease-out forwards; font-size: 2rem; }

Â  Â  Â  Â  /* ×¨×¡×¤×•× ×¡×™×‘×™×•×ª */
Â  Â  Â  Â  @media (max-width: 480px) {
Â  Â  Â  Â  Â  Â  .game-title { font-size: 3rem; }
Â  Â  Â  Â  Â  Â  .options-grid { grid-template-columns: 1fr; }
Â  Â  Â  Â  Â  Â  .btn { width: 100%; }
Â  Â  Â  Â  Â  Â  .name-input { width: 100%; }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

Â  Â  <!-- Audio Context (Hidden) -->
Â  Â  <div id="audio-controller"></div>

Â  Â  <!-- Achievements / Leaderboard Modal -->
Â  Â  <div id="leaderboard-modal" class="modal-overlay">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="modal-back-btn" id="modal-back-btn" onclick="backToLeaderboard()"><i data-lucide="arrow-right"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="modal-title">ğŸ† ×”×™×›×œ ×”×ª×”×™×œ×”</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="modal-body" id="modal-body-content">
Â  Â  Â  Â  Â  Â  Â  Â  <!-- Content injected via JS -->
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="modal-footer">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn" style="width: auto; padding: 10px 30px;" onclick="closeModal('leaderboard-modal')">×¡×’×•×¨</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Shop Modal -->
Â  Â  <div id="shop-modal" class="modal-overlay">
Â  Â  Â  Â  <div class="modal-content" style="border-color: var(--shop);">
Â  Â  Â  Â  Â  Â  <div class="modal-header" style="color: var(--shop);">ğŸ›’ ×—× ×•×ª ×”××©×—×§</div>
Â  Â  Â  Â  Â  Â  <div class="modal-body">
Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align:center; margin-bottom:15px; color:var(--text-muted);">×”××©×—×§ × ×¢×¦×¨. ×§× ×” ×‘×—×•×›××”! (×”××—×™×¨×™× ×¢×•×œ×™× ×‘×›×œ ×©×œ×‘)</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="shop-item" onclick="buyItem('time_small')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item-title">â° ×ª×•×¡×¤×ª ×–××Ÿ ×§×¦×¨×”</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item-desc">+10 ×©× ×™×•×ª</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item-price" id="shop-price-time-small">â‚ª500</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="shop-item" onclick="buyItem('time_big')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item-title">â³ ×ª×•×¡×¤×ª ×–××Ÿ ×’×“×•×œ×”</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item-desc">+30 ×©× ×™×•×ª</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item-price" id="shop-price-time-big">â‚ª1,200</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="shop-item" onclick="buyItem('lifelines')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item-title">â¤ï¸ ××™×œ×•×™ ×¢×–×¨×•×ª</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item-desc">××—×–×™×¨ ××ª ×›×œ ×”×¢×–×¨×•×ª</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="shop-item-price" id="shop-price-lifelines">â‚ª2,000</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="modal-footer">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-outline" onclick="closeShop()">×—×–×•×¨ ×œ××©×—×§</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Instructions Modal -->
Â  Â  <div id="instructions-modal" class="modal-overlay">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <div class="modal-header">ğŸ“œ ××™×š ××©×—×§×™×?</div>
Â  Â  Â  Â  Â  Â  <div class="modal-body" style="text-align: right; line-height: 1.6;">
Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-bottom: 15px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="color: var(--secondary); margin-bottom: 5px;">âš¡ ×”××˜×¨×”</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ×œ×¢× ×•×ª ×¢×œ ×›××” ×©×™×•×ª×¨ ×©××œ×•×ª, ×œ×¦×‘×•×¨ ×›×¡×£ ×•×œ×©×¨×•×“ ×›××” ×©×™×•×ª×¨ ×–××Ÿ!
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-bottom: 15px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="color: var(--warning); margin-bottom: 5px;">â³ ×—×•×§×™ ×‘×¡×™×¡</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul style="padding-right: 20px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>×”×–××Ÿ ×”×•× ×”××©××‘ ×”×›×™ ×—×©×•×‘ (× ×’××¨ = ×”×¤×¡×“).</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>×ª×©×•×‘×” × ×›×•× ×” ××¢× ×™×§×” <b>×‘×•× ×•×¡ ×–××Ÿ ×•×›×¡×£</b>.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>×ª×©×•×‘×” ×©×’×•×™×” ×’×•×¨×¨×ª <b>×§× ×¡ ×–××Ÿ</b>.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-bottom: 15px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="color: var(--shop); margin-bottom: 5px;">ğŸ›’ ×”×—× ×•×ª</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ××¤×©×¨ ×œ×”××™×¨ ××ª ×”×›×¡×£ ×©×¦×‘×¨×ª× ×œ×–××Ÿ × ×•×¡×£ ××• ×œ××™×œ×•×™ ×¢×–×¨×•×ª.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <br><small>×”××—×™×¨×™× ×¢×•×œ×™× ×›×›×œ ×©××ª×§×“××™× ×‘×©×œ×‘×™×!</small>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="color: var(--success); margin-bottom: 5px;">ğŸ†˜ ×’×œ×’×œ×™ ×”×¦×œ×”</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul style="list-style: none; padding: 0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li style="margin-bottom: 5px;">ğŸŒ— <b>50:50</b> - ××¡×™×¨ 2 ×ª×©×•×‘×•×ª ×©×’×•×™×•×ª.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li style="margin-bottom: 5px;">ğŸ¤– <b>AI</b> - ××ª×™×™×¢×¥ ×¢× ×”×‘×™× ×” ×”××œ××›×•×ª×™×ª (×œ× ×ª××™×“ ×¦×•×“×§×ª!).</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>â„ï¸ <b>×”×§×¤××”</b> - ×¢×•×¦×¨ ××ª ×”×–××Ÿ ×œ-5 ×©× ×™×•×ª.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="modal-footer">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn" style="width: auto; padding: 10px 30px;" onclick="closeModal('instructions-modal')">×”×‘× ×ª×™, ×™××œ×œ×”!</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- ××¡×š ×ª×¤×¨×™×˜ ×¨××©×™ -->
Â  Â  <div id="menu-screen" class="screen active">
Â  Â  Â  Â  <div class="game-title">××™×¨×•×¥ ×”×™×“×¢</div>
Â  Â  Â  Â  <div class="subtitle">×”×–××Ÿ ×”×•× ×”×›×¡×£ ×©×œ×š. ××œ ×ª×‘×–×‘×– ××•×ª×•.</div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <input type="text" id="player-name-input" class="name-input" placeholder="×”×›× ×¡ ××ª ×©××š..." maxlength="15">

Â  Â  Â  Â  <button class="btn" onclick="startGame()">
Â  Â  Â  Â  Â  Â  <i data-lucide="play"></i> ×”×ª×—×œ ××©×—×§
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <button class="btn btn-outline" onclick="openLeaderboard()">
Â  Â  Â  Â  Â  Â  <i data-lucide="trophy"></i> ×”×™×©×’×™× ×•×©×™××™×
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <button class="btn btn-outline" onclick="openInstructions()">
Â  Â  Â  Â  Â  Â  <i data-lucide="book-open"></i> ×”×•×¨××•×ª ××©×—×§
Â  Â  Â  Â  </button>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div style="margin-top: 30px; font-size: 0.8rem; color: #555;">
Â  Â  Â  Â  Â  Â  ××•×¤×¢×œ ×¢"×™ Gemini AI
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- ××¡×š ×˜×¢×™× ×” (×‘×™×Ÿ ×©×œ×‘×™×) -->
Â  Â  <div id="loading-screen" class="screen">
Â  Â  Â  Â  <div class="loader"></div>
Â  Â  Â  Â  <div class="loading-text" id="loading-msg">××›×™×Ÿ ××ª ×”××•×—...</div>
Â  Â  Â  Â  <div class="loading-tip" id="loading-tip">×˜×™×¤: ×©××œ×•×ª ×§×©×•×ª × ×•×ª× ×•×ª ×¤×—×•×ª ×–××Ÿ ××‘×œ ×™×•×ª×¨ ×›×¡×£!</div>
Â  Â  </div>

Â  Â  <!-- ××¡×š ××©×—×§ -->
Â  Â  <div id="game-screen" class="screen">
Â  Â  Â  Â  <div class="hud">
Â  Â  Â  Â  Â  Â  <div class="stat-box" id="hud-time">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-label">×–××Ÿ</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-value" id="time-display">120.0</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="stat-box" id="hud-stage">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-label">×©×œ×‘</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-value" id="stage-display">1</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="stat-box" id="hud-money">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-label">×§×•×¤×”</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-value" style="color: var(--success);">â‚ª<span id="score-display">0</span></span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="timer-container">
Â  Â  Â  Â  Â  Â  <div class="timer-bar" id="timer-bar"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="progress-text" id="stage-progress">×©××œ×” 1 ××ª×•×š 15</div>

Â  Â  Â  Â  <div class="question-card">
Â  Â  Â  Â  Â  Â  <div id="question-category" style="position: absolute; top: -10px; right: 20px; background: var(--primary); padding: 2px 10px; border-radius: 10px; font-size: 0.8rem;">×›×œ×œ×™</div>
Â  Â  Â  Â  Â  Â  <div class="question-text" id="question-text">
Â  Â  Â  Â  Â  Â  Â  Â  ×”×©××œ×” ×ª×•×¤×™×¢ ×›××Ÿ...
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="options-grid" id="options-container">
Â  Â  Â  Â  Â  Â  Â  Â  <!-- ×›×¤×ª×•×¨×™ ×ª×©×•×‘×•×ª -->
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="ai-thinking" id="ai-bubble">Gemini ×—×•×©×‘...</div>

Â  Â  Â  Â  <div class="bottom-controls">
Â  Â  Â  Â  Â  Â  <div class="lifelines">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="lifeline-btn" id="btn-5050" onclick="useLifeline('5050')" title="50/50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="lifeline-badge">1</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-weight: bold;">50:50</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="lifeline-btn" id="btn-ai" onclick="useLifeline('ai')" title="×©××œ ××ª Gemini">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="lifeline-badge">1</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="bot"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="lifeline-btn" id="btn-freeze" onclick="useLifeline('freeze')" title="×”×§×¤××ª ×–××Ÿ">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="lifeline-badge">1</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="snowflake"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button class="btn btn-shop" onclick="openShop()" style="width: auto; border-radius: 50%; width: 60px; height: 60px; padding: 0;">
Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="shopping-cart"></i>
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- ××¡×š ×¡×™×•× -->
Â  Â  <div id="gameover-screen" class="screen">
Â  Â  Â  Â  <h1 style="font-size: 3rem; color: var(--danger); margin: 0;">× ×’××¨ ×”×–××Ÿ!</h1>
Â  Â  Â  Â  <p class="subtitle" id="gameover-reason">×”×©×¢×•×Ÿ ×”×’×™×¢ ×œ-0</p>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div style="background: var(--bg-card); padding: 20px; border-radius: 15px; width: 100%; margin-bottom: 20px;">
Â  Â  Â  Â  Â  Â  <div class="stat-row">
Â  Â  Â  Â  Â  Â  Â  Â  <span>×©×—×§×Ÿ:</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span style="color: var(--secondary); font-weight: bold;" id="final-name">××•×¨×—</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="stat-row">
Â  Â  Â  Â  Â  Â  Â  Â  <span>×¡×›×•× ×¡×•×¤×™:</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span style="color: var(--success); font-weight: bold;" id="final-score">â‚ª0</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="stat-row">
Â  Â  Â  Â  Â  Â  Â  Â  <span>×©×œ×‘ ×©×”×’×¢×ª:</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="final-stage">1</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="stat-row">
Â  Â  Â  Â  Â  Â  Â  Â  <span>×©××œ×•×ª × ×›×•× ×•×ª:</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="final-correct">0</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button class="btn" onclick="returnToMenu()">
Â  Â  Â  Â  Â  Â  <i data-lucide="home"></i> ×ª×¤×¨×™×˜ ×¨××©×™
Â  Â  Â  Â  </button>
Â  Â  </div>

Â  Â  <script>
// --- 1. CONFIGURATION & STATE ---
Â  Â  Â  Â  // API KEY removed for server-side handling
Â  Â  Â  Â Â 
Â  Â  Â  Â  const GAME_CONFIG = {
Â  Â  Â  Â  Â  Â  initialTime: 60,Â 
Â  Â  Â  Â  Â  Â  baseMoney: 100,
Â  Â  Â  Â  Â  Â  moneyMultiplier: 1.2,Â 
Â  Â  Â  Â  Â  Â  timeBonusBase: 7,Â 
Â  Â  Â  Â  Â  Â  timePenaltyBase: 4,Â 
Â  Â  Â  Â  Â  Â  questionsPerStage: 30, // <--- ×¢×•×“×›×Ÿ ×œ-30 ×©××œ×•×ª ×œ×§×¨×™××” ×™×¢×™×œ×” ×™×•×ª×¨
Â  Â  Â  Â  Â  Â  randomSubjectsCount: 3,
Â  Â  Â  Â  Â  Â  // Base prices now, calculation is dynamic
Â  Â  Â  Â  Â  Â  baseShopPrices: {
Â  Â  Â  Â  Â  Â  Â  Â  time_small: 100,
Â  Â  Â  Â  Â  Â  Â  Â  time_big: 200,
Â  Â  Â  Â  Â  Â  Â  Â  lifelines: 400
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  const SUBJECTS = [
Â  Â  Â  Â  Â  Â  "×™×“×¢ ×›×œ×œ×™ ×•×˜×¨×™×•×•×™×”", "×¢×•×‘×“×•×ª ××¢× ×™×™× ×•×ª (×”×™×“×¢×ª?)", "××•×©×’×™× ×‘×¡×™×¡×™×™× ×‘×¢×•×œ×",
Â  Â  Â  Â  Â  Â  "×”×™×¡×˜×•×¨×™×” ×©×œ ××“×™× ×ª ×™×©×¨××œ", "×’××•×’×¨×¤×™×” ×©×œ ×™×©×¨××œ", "×ª×¨×‘×•×ª ×™×©×¨××œ×™×ª ×•×¡×œ× ×’",Â 
Â  Â  Â  Â  Â  Â  "×“××•×™×•×ª ×™×©×¨××œ×™×•×ª ×—×©×•×‘×•×ª", "×¦×”\"×œ ×•××œ×—××•×ª ×™×©×¨××œ", "××•×¡×“×•×ª ×”××“×™× ×”",
Â  Â  Â  Â  Â  Â  "×“×’×œ×™× ×•×¢×¨×™ ×‘×™×¨×”", "×’××•×’×¨×¤×™×” ×¢×•×œ××™×ª", "××ª×¨×™× ××¤×•×¨×¡××™× ×‘×¢×•×œ×",
Â  Â  Â  Â  Â  Â  "×ª×¨×‘×•×™×•×ª ×•×× ×”×’×™×", "×—×’×™× ×‘×¢×•×œ×", "××•×§×™×™× ×•×¡×™× ×•×™×‘×©×•×ª",
Â  Â  Â  Â  Â  Â  "×¡×¨×˜×™× ×•×§×•×œ× ×•×¢ (Marvel/Disney)", "×¡×“×¨×•×ª ×˜×œ×•×•×™×–×™×” ××¤×•×¨×¡××•×ª", "××•×–×™×§×” ×™×©×¨××œ×™×ª ×•×‘×™× ×œ××•××™×ª",
Â  Â  Â  Â  Â  Â  "×–×™×”×•×™ ×©×™×¨×™× ×œ×¤×™ ××™×œ×™×", "×× ×™××¦×™×” ×•×× ×™××”", "×¡×œ×‘×¡ ×•×¨×›×™×œ×•×ª",
Â  Â  Â  Â  Â  Â  "××©×—×§×™ ××—×©×‘ (Fortnite, Minecraft)", "×™×•×˜×™×•×‘×¨×™× ×•×¡×˜×¨×™××¨×™×", "×˜×¨× ×“×™× ×‘×˜×™×§×˜×•×§",
Â  Â  Â  Â  Â  Â  "×××•×’'×™× ×•××©××¢×•×ª×", "×¡×œ× ×’ ×¨×©×ª ×•××™××™× (Memes)",
Â  Â  Â  Â  Â  Â  "×‘×¢×œ×™ ×—×™×™× ×•×˜×‘×¢", "×’×•×£ ×”××“× ×•×¨×¤×•××”", "××¡×˜×¨×•× ×•××™×” ×•×—×œ×œ",
Â  Â  Â  Â  Â  Â  "×”××¦××•×ª ×•×˜×›× ×•×œ×•×’×™×”", "×¤×™×–×™×§×” ×•×›×™××™×” ×‘×¡×™×¡×™×ª", "××ª××˜×™×§×” ×•×œ×•×’×™×§×”",
Â  Â  Â  Â  Â  Â  "×××›×œ×™× ××›×œ ×”×¢×•×œ×", "××˜×‘×— ×™×©×¨××œ×™", "×›×“×•×¨×’×œ ×¢×•×œ××™ (××•× ×“×™××œ, ××œ×•×¤×•×ª)",
Â  Â  Â  Â  Â  Â  "×›×“×•×¨×’×œ ×™×©×¨××œ×™", "×›×“×•×¨×¡×œ (NBA/×™×•×¨×•×œ×™×’)", "×©×™××™ ×¡×¤×•×¨×˜",
Â  Â  Â  Â  Â  Â  "×—×™×“×•×ª '××” ×× ×™?'", "×—×™×“×•×ª ×§×•××‘×™× ×˜×•×¨×™×•×ª ×§×œ×•×ª", "×ª×¨×—×™×©×™ ×—×©×™×‘×” ×•×œ×•×’×™×§×”",Â 
Â  Â  Â  Â  Â  Â  "×—×™×“×•×ª ×‘×œ×©×™×•×ª (××™ ×’× ×‘ ××ª ×”×™×”×œ×•×?)", "×¡×“×¨×•×ª ×œ×•×’×™×•×ª ×œ× ××¡×¤×¨×™×•×ª",
Â  Â  Â  Â  Â  Â  "×¢×•×‘×“×•×ª ××•×–×¨×•×ª (× ×›×•×Ÿ/×œ× × ×›×•×Ÿ)", "××™×ª×•×¡×™× ×•×××•× ×•×ª ×ª×¤×œ×•×ª", "×˜×¨× ×“×™× ×•×¡×œ×‘×¡ - ×××ª ××• ×©×§×¨?",
Â  Â  Â  Â  Â  Â  "×”×©×œ××ª ×¤×ª×’××™× ×•××˜×‘×¢×•×ª ×œ×©×•×Ÿ", "×”×©×œ××ª ××©×¤×˜×™× ××©×™×¨×™× ××•×›×¨×™×", "×¦×™×˜×•×˜×™× ××¡×¨×˜×™× ×•×¡×“×¨×•×ª",
Â  Â  Â  Â  Â  Â  "×—×©×‘×•×Ÿ ××”×™×¨ ×•×—×™×©×•×‘ ×× ×˜×œ×™", "××—×•×–×™× ×•×‘×¢×™×•×ª ××™×œ×•×œ×™×•×ª", "×¡×“×¨ ×¤×¢×•×œ×•×ª ×—×©×‘×•×Ÿ",
Â  Â  Â  Â  Â  Â  "×’××•××˜×¨×™×” ×•×¦×•×¨×•×ª", "×¡×“×¨×•×ª ××ª××˜×™×•×ª",
Â  Â  Â  Â  Â  Â  "××‘×—× ×™ IQ - ×¡×“×¨×•×ª ×¦×•×¨×•×ª", "×× ×œ×•×’×™×•×ª ××™×œ×•×œ×™×•×ª (×™×—×¡×™×)", "×™×•×¦× ×“×•×¤×Ÿ"
Â  Â  Â  Â  ];

Â  Â  Â  Â  const ACHIEVEMENTS_LIST = [
Â  Â  Â  Â  Â  Â  { id: 'correct_100', icon: 'ğŸ§ ', title: '××•×— ×¢×œ', desc: '×¢× ×™×ª ×¢×œ 100 ×©××œ×•×ª × ×›×•× ×•×ª' },
Â  Â  Â  Â  Â  Â  { id: 'stage_10', icon: 'ğŸš€', title: '×˜×™×™×¡ ×—×œ×œ', desc: '×”×’×¢×ª ×œ×©×œ×‘ 10' },
Â  Â  Â  Â  Â  Â  { id: 'streak_10', icon: 'ğŸ”¥', title: '×‘×œ×ª×™ × ×™×ª×Ÿ ×œ×¢×¦×™×¨×”', desc: '×¨×¦×£ ×©×œ 10 ×ª×©×•×‘×•×ª × ×›×•× ×•×ª' },
Â  Â  Â  Â  Â  Â  { id: 'survivor', icon: 'â±ï¸', title: '×”×©×•×¨×“ ×”××—×¨×•×Ÿ', desc: '× ×™×¦×—×ª ×©×œ×‘ ×¢× ×¤×—×•×ª ××©× ×™×™×” ××—×ª' },
Â  Â  Â  Â  Â  Â  { id: 'rich', icon: 'ğŸ’', title: '××™×œ×™×•× ×¨', desc: '×¦×‘×¨×ª ××¢×œ â‚ª10,000' },
Â  Â  Â  Â  Â  Â  { id: 'spender', icon: 'ğŸ’¸', title: '×‘×–×‘×–×Ÿ', desc: '×§× ×™×ª ×¤×¨×™×˜ ×‘×—× ×•×ª' },
Â  Â  Â  Â  Â  Â  { id: 'time_lord', icon: 'â³', title: '××“×•×Ÿ ×”×–××Ÿ', desc: '×¦×‘×¨×ª ××¢×œ 200 ×©× ×™×•×ª ×¢×œ ×”×©×¢×•×Ÿ' },
Â  Â  Â  Â  Â  Â  { id: 'phoenix', icon: 'ğŸ¦…', title: '×¢×•×£ ×”×—×•×œ', desc: '×—×–×¨×ª ×œ××©×—×§ ×××ª×—×ª ×œ-5 ×©× ×™×•×ª' }
Â  Â  Â  Â  ];

Â  Â  Â  Â  let state = {
Â  Â  Â  Â  Â  Â  isPlaying: false,
Â  Â  Â  Â  Â  Â  playerName: "××•×¨×—",
Â  Â  Â  Â  Â  Â  timeLeft: 120,
Â  Â  Â  Â  Â  Â  score: 0,
Â  Â  Â  Â  Â  Â  stage: 1,Â 
Â  Â  Â  Â  Â  Â  totalCorrect: 0,Â 
Â  Â  Â  Â  Â  Â  currentStageCorrect: 0,
Â  Â  Â  Â  Â  Â  questionInStageIndex: 0,Â 
Â  Â  Â  Â  Â  Â  currentQuestion: null,
Â  Â  Â  Â  Â  Â  questionQueue: [],
Â  Â  Â  Â  Â  Â  streak: 0,
Â  Â  Â  Â  Â  Â  lifelines: { '5050': 1, 'ai': 1, 'freeze': 1 },
Â  Â  Â  Â  Â  Â  isFrozen: false,
Â  Â  Â  Â  Â  Â  isShopOpen: false,
Â  Â  Â  Â  Â  Â  lastFrameTime: 0,
Â  Â  Â  Â  Â  Â  questionStartTime: 0,
Â  Â  Â  Â  Â  Â  unlockedAchievements: []
Â  Â  Â  Â  };

Â  Â  Â  Â  let audioCtx = null;

Â  Â  Â  Â  // --- 2. AUDIO SYSTEM ---
Â  Â  Â  Â  class SoundManager {
Â  Â  Â  Â  Â  Â  constructor() { this.init(); }
Â  Â  Â  Â  Â  Â  init() {
Â  Â  Â  Â  Â  Â  Â  Â  window.AudioContext = window.AudioContext || window.webkitAudioContext;
Â  Â  Â  Â  Â  Â  Â  Â  if (!audioCtx) audioCtx = new AudioContext();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  playTone(freq, type, duration) {
Â  Â  Â  Â  Â  Â  Â  Â  if (!audioCtx) this.init();
Â  Â  Â  Â  Â  Â  Â  Â  if (audioCtx.state === 'suspended') audioCtx.resume();
Â  Â  Â  Â  Â  Â  Â  Â  const osc = audioCtx.createOscillator();
Â  Â  Â  Â  Â  Â  Â  Â  const gain = audioCtx.createGain();
Â  Â  Â  Â  Â  Â  Â  Â  osc.type = type;
Â  Â  Â  Â  Â  Â  Â  Â  osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
Â  Â  Â  Â  Â  Â  Â  Â  gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
Â  Â  Â  Â  Â  Â  Â  Â  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
Â  Â  Â  Â  Â  Â  Â  Â  osc.connect(gain);
Â  Â  Â  Â  Â  Â  Â  Â  gain.connect(audioCtx.destination);
Â  Â  Â  Â  Â  Â  Â  Â  osc.start();
Â  Â  Â  Â  Â  Â  Â  Â  osc.stop(audioCtx.currentTime + duration);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  playCorrect() { this.playTone(600, 'sine', 0.1); setTimeout(() => this.playTone(800, 'sine', 0.2), 100); }
Â  Â  Â  Â  Â  Â  playWrong() { this.playTone(150, 'sawtooth', 0.3); setTimeout(() => this.playTone(100, 'sawtooth', 0.4), 150); }
Â  Â  Â  Â  Â  Â  playTick() { this.playTone(800, 'square', 0.05); }
Â  Â  Â  Â  Â  Â  playWin() { [400, 500, 600, 800].forEach((freq, i) => setTimeout(() => this.playTone(freq, 'triangle', 0.2), i * 100)); }
Â  Â  Â  Â  Â  Â  playSpeedBonus() { this.playTone(1000, 'sine', 0.1); setTimeout(() => this.playTone(1500, 'sine', 0.1), 100); }
Â  Â  Â  Â  Â  Â  playCash() { this.playTone(1200, 'sine', 0.1); setTimeout(() => this.playTone(2000, 'square', 0.2), 100); }
Â  Â  Â  Â  }
Â  Â  Â  Â  const sound = new SoundManager();

Â  Â  Â  Â  // --- 3. GEMINI API SERVICE (Via Vercel Function) ---
Â  Â  Â  Â  async function fetchQuestionsFromAI(count, currentStage) {
Â  Â  Â  Â  Â  Â  const shuffledSubjects = [...SUBJECTS].sort(() => 0.5 - Math.random());
Â  Â  Â  Â  Â  Â  const selectedSubjects = shuffledSubjects.slice(0, GAME_CONFIG.randomSubjectsCount);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const difficulty = currentStage < 3 ? "×§×œ" : (currentStage < 7 ? "×‘×™× ×•× ×™" : "×§×©×” ×•×××ª×’×¨");
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const prompt = `
Â  Â  Â  Â  Â  Â  ×¦×•×¨ ${count} ×©××œ×•×ª ×˜×¨×™×•×•×™×” ×‘×¢×‘×¨×™×ª (×œ×¨×•×‘ ×××¨×™×§××™×•×ª ×¢× 4 ×ª×©×•×‘×•×ª).
Â  Â  Â  Â  Â  Â  ×¢×‘×•×¨ ×©××œ×•×ª "× ×›×•×Ÿ/×œ× × ×›×•×Ÿ", ×¡×¤×§ 2-4 ××¤×©×¨×•×™×•×ª.
Â  Â  Â  Â  Â  Â  ×¢×¨×‘×‘ ×©××œ×•×ª ××”× ×•×©××™× ×”×‘××™×: ${selectedSubjects.join(", ")}.
Â  Â  Â  Â  Â  Â  ×¨××ª ×§×•×©×™: ${difficulty}.
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  ×”×—×–×¨ JSON ×‘×œ×‘×“ (××¢×¨×š ××•×‘×™×™×§×˜×™×):
Â  Â  Â  Â  Â  Â  [
Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  "question": "×©××œ×”?",
Â  Â  Â  Â  Â  Â  Â  Â  "options": ["×ª×©×•×‘×”1", "×ª×©×•×‘×”2", "×ª×©×•×‘×”3", "×ª×©×•×‘×”4"],
Â  Â  Â  Â  Â  Â  Â  Â  "correctIndex": 0,
Â  Â  Â  Â  Â  Â  Â  Â  "hint": "×¨××– ×§×¦×¨",
Â  Â  Â  Â  Â  Â  Â  Â  "category": "×©× ×”× ×•×©× ×”×¨×œ×•×•× ×˜×™"
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Modified for Vercel Serverless Function Proxy
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/api/generate', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ prompt })Â 
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error("Server error");

Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Assuming server returns the cleaned JSON array directly or structure we parse
Â  Â  Â  Â  Â  Â  Â  Â  // If the server returns standard gemini response, we parse.Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Let's assume server returns { candidates: [...] } or just the array if we clean it there.
Â  Â  Â  Â  Â  Â  Â  Â  // For safety, let's keep parsing logic here similar to before if server forwards raw gemini response.
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // If your server cleans it, great. If not, we parse:
Â  Â  Â  Â  Â  Â  Â  Â  if (data.candidates) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const text = data.candidates[0].content.parts[0].text;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const jsonStr = text.replace(/```json/g, '').replace(/```/g, '').trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return JSON.parse(jsonStr);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // If server returned cleaned array directly
Â  Â  Â  Â  Â  Â  Â  Â  if (Array.isArray(data)) return data;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Fallback attempt to parse text if needed
Â  Â  Â  Â  Â  Â  Â  Â  return data;Â 

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("AI Error:", error);
Â  Â  Â  Â  Â  Â  Â  Â  return Array(count).fill({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  question: "×©××œ×” ×œ×“×•×’××” (×©×’×™××ª ×¨×©×ª)",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: ["××•×¤×¦×™×” 1", "××•×¤×¦×™×” 2", "××•×¤×¦×™×” 3", "××•×¤×¦×™×” 4"],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  correctIndex: 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  category: "×©×’×™××”",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hint: "× ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨"
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- 4. GAME ENGINE ---

Â  Â  Â  Â  function initGame() {
Â  Â  Â  Â  Â  Â  lucide.createIcons();
Â  Â  Â  Â  Â  Â  loadLocalAchievements();
Â  Â  Â  Â  }

Â  Â  Â  Â  function loadLocalAchievements() {
Â  Â  Â  Â  Â  Â  const saved = localStorage.getItem('triviaRushAchievements');
Â  Â  Â  Â  Â  Â  if (saved) {
Â  Â  Â  Â  Â  Â  Â  Â  state.unlockedAchievements = JSON.parse(saved);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function checkAchievements() {
Â  Â  Â  Â  Â  Â  const newUnlocks = [];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (state.totalCorrect >= 100 && !hasAchievement('correct_100')) newUnlocks.push('correct_100');
Â  Â  Â  Â  Â  Â  if (state.stage >= 10 && !hasAchievement('stage_10')) newUnlocks.push('stage_10');
Â  Â  Â  Â  Â  Â  if (state.streak >= 10 && !hasAchievement('streak_10')) newUnlocks.push('streak_10');
Â  Â  Â  Â  Â  Â  if (state.score >= 10000 && !hasAchievement('rich')) newUnlocks.push('rich');
Â  Â  Â  Â  Â  Â  if (state.timeLeft >= 200 && !hasAchievement('time_lord')) newUnlocks.push('time_lord');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (newUnlocks.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  newUnlocks.forEach(id => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.unlockedAchievements.push(id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatingText(`ğŸ† ×”×™×©×’ ×—×“×©!`, 'general', 'gold');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('triviaRushAchievements', JSON.stringify(state.unlockedAchievements));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function unlockAchievement(id) {
Â  Â  Â  Â  Â  Â  if (!hasAchievement(id)) {
Â  Â  Â  Â  Â  Â  Â  Â  state.unlockedAchievements.push(id);
Â  Â  Â  Â  Â  Â  Â  Â  showFloatingText(`ğŸ† ×”×™×©×’ ×—×“×©!`, 'general', 'gold');
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('triviaRushAchievements', JSON.stringify(state.unlockedAchievements));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function hasAchievement(id) {
Â  Â  Â  Â  Â  Â  return state.unlockedAchievements.includes(id);
Â  Â  Â  Â  }

Â  Â  Â  Â  async function startGame() {
Â  Â  Â  Â  Â  Â  const nameInput = document.getElementById('player-name-input');
Â  Â  Â  Â  Â  Â  const playerName = nameInput.value.trim();
Â  Â  Â  Â  Â  Â  if (!playerName) { alert("×™××œ×œ×”, ×ª×Ÿ ×©× ×•× ×ª×—×™×œ!"); nameInput.focus(); return; }

Â  Â  Â  Â  Â  Â  state.playerName = playerName;
Â  Â  Â  Â  Â  Â  switchScreen('loading-screen');
Â  Â  Â  Â  Â  Â  resetGameState();
Â  Â  Â  Â  Â  Â  await loadNextBatch();
Â  Â  Â  Â  Â  Â  switchScreen('game-screen');
Â  Â  Â  Â  Â  Â  state.lastFrameTime = performance.now();
Â  Â  Â  Â  Â  Â  requestAnimationFrame(gameLoop);
Â  Â  Â  Â  Â  Â  renderQuestion();
Â  Â  Â  Â  Â  Â  updateHUD();
Â  Â  Â  Â  }

Â  Â  Â  Â  function resetGameState() {
Â  Â  Â  Â  Â  Â  state.isPlaying = true;
Â  Â  Â  Â  Â  Â  state.timeLeft = GAME_CONFIG.initialTime;
Â  Â  Â  Â  Â  Â  state.score = 0;
Â  Â  Â  Â  Â  Â  state.stage = 1;
Â  Â  Â  Â  Â  Â  state.totalCorrect = 0;
Â  Â  Â  Â  Â  Â  state.questionInStageIndex = 0;
Â  Â  Â  Â  Â  Â  state.streak = 0;
Â  Â  Â  Â  Â  Â  state.questionQueue = [];
Â  Â  Â  Â  Â  Â  state.lifelines = { '5050': 1, 'ai': 1, 'freeze': 1 };
Â  Â  Â  Â  Â  Â  state.isFrozen = false;
Â  Â  Â  Â  Â  Â  state.isShopOpen = false;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.lifeline-btn').forEach(btn => {
Â  Â  Â  Â  Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  btn.style.opacity = '1';
Â  Â  Â  Â  Â  Â  Â  Â  btn.querySelector('.lifeline-badge').textContent = '1';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  async function loadNextBatch() {
Â  Â  Â  Â  Â  Â  const loadingTips = [
Â  Â  Â  Â  Â  Â  Â  Â  "×˜×™×§×˜×•×§ ×–×” × ×—××“, ××‘×œ ×¤×” ×”××•×— ×¢×•×‘×“! ğŸ§ ",
Â  Â  Â  Â  Â  Â  Â  Â  "×˜×•×¢×Ÿ ×©××œ×•×ª ×©×œ ××œ×•×¤×™×... ğŸ’ª",
Â  Â  Â  Â  Â  Â  Â  Â  "×¨×’×¢, ××—×“×“ ××ª ×”×ª×©×•×‘×•×ª... âœï¸",
Â  Â  Â  Â  Â  Â  Â  Â  "××™ ×©×§×•×¨× ××ª ×–×” ×™×§×‘×œ ××–×œ ×‘×—×™×™×! ğŸ€",
Â  Â  Â  Â  Â  Â  Â  Â  "××¢×¨×‘×‘ × ×•×©××™× ×›××• ×©×™×™×§ ×¤×™×¨×•×ª... ğŸ¥¤"
Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  document.getElementById('loading-msg').textContent = "××›×™×Ÿ ××ª ×”×©×œ×‘ ×”×‘×...";
Â  Â  Â  Â  Â  Â  document.getElementById('loading-tip').textContent = loadingTips[Math.floor(Math.random() * loadingTips.length)];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const newQuestions = await fetchQuestionsFromAI(GAME_CONFIG.questionsPerStage, state.stage);
Â  Â  Â  Â  Â  Â  Â  Â  state.questionQueue = [...state.questionQueue, ...newQuestions];
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Failed loading batch");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function gameLoop(timestamp) {
Â  Â  Â  Â  Â  Â  if (!state.isPlaying) return;
Â  Â  Â  Â  Â  Â  if (!state.lastFrameTime) state.lastFrameTime = timestamp;
Â  Â  Â  Â  Â  Â  const deltaTime = (timestamp - state.lastFrameTime) / 1000;
Â  Â  Â  Â  Â  Â  state.lastFrameTime = timestamp;

Â  Â  Â  Â  Â  Â  if (!state.isFrozen && !state.isShopOpen) {
Â  Â  Â  Â  Â  Â  Â  Â  state.timeLeft -= deltaTime;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (state.timeLeft <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  state.timeLeft = 0;
Â  Â  Â  Â  Â  Â  Â  Â  gameOver("× ×’××¨ ×”×–××Ÿ! ğŸ•’");
Â  Â  Â  Â  Â  Â  Â  Â  updateHUD();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (state.timeLeft < 10 && state.timeLeft > 0 && !state.isShopOpen && !state.isFrozen) {
Â  Â  Â  Â  Â  Â  Â  Â  const prevSec = Math.ceil(state.timeLeft + deltaTime);
Â  Â  Â  Â  Â  Â  Â  Â  const currSec = Math.ceil(state.timeLeft);
Â  Â  Â  Â  Â  Â  Â  Â  if (prevSec !== currSec) sound.playTick();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateHUD();
Â  Â  Â  Â  Â  Â  requestAnimationFrame(gameLoop);
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateHUD() {
Â  Â  Â  Â  Â  Â  document.getElementById('time-display').textContent = state.timeLeft.toFixed(1);
Â  Â  Â  Â  Â  Â  document.getElementById('score-display').textContent = state.score.toLocaleString();
Â  Â  Â  Â  Â  Â  document.getElementById('stage-display').textContent = state.stage;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const currentQ = state.questionInStageIndex + 1;
Â  Â  Â  Â  Â  Â  document.getElementById('stage-progress').textContent = `×©××œ×” ${currentQ} ××ª×•×š ${GAME_CONFIG.questionsPerStage} ×‘×©×œ×‘ ${state.stage}`;

Â  Â  Â  Â  Â  Â  const timerBar = document.getElementById('timer-bar');
Â  Â  Â  Â  Â  Â  const percent = (state.timeLeft / GAME_CONFIG.initialTime) * 100;Â 
Â  Â  Â  Â  Â  Â  timerBar.style.width = Math.min(Math.max(percent, 0), 100) + '%';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (state.timeLeft < 10) timerBar.classList.add('danger');
Â  Â  Â  Â  Â  Â  else timerBar.classList.remove('danger');
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderQuestion() {
Â  Â  Â  Â  Â  Â  if (state.questionQueue.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  state.stage++;
Â  Â  Â  Â  Â  Â  Â  Â  state.questionInStageIndex = 0;
Â  Â  Â  Â  Â  Â  Â  Â  state.isFrozen = true;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (state.timeLeft < 1 && !hasAchievement('survivor')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  unlockAchievement('survivor');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  switchScreen('loading-screen');
Â  Â  Â  Â  Â  Â  Â  Â  loadNextBatch().then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switchScreen('game-screen');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.isFrozen = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderQuestion();
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const q = state.questionQueue.shift();
Â  Â  Â  Â  Â  Â  state.currentQuestion = q;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  state.questionStartTime = Date.now();

Â  Â  Â  Â  Â  Â  const container = document.getElementById('options-container');
Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('question-text').textContent = q.question;
Â  Â  Â  Â  Â  Â  document.getElementById('question-category').textContent = q.category || "×›×œ×œ×™";

Â  Â  Â  Â  Â  Â  q.options.forEach((opt, idx) => {
Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  btn.className = 'option-btn';
Â  Â  Â  Â  Â  Â  Â  Â  btn.textContent = opt;
Â  Â  Â  Â  Â  Â  Â  Â  btn.onclick = () => handleAnswer(idx, btn);
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(btn);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  updateHUD();
Â  Â  Â  Â  }

Â  Â  Â  Â  function handleAnswer(selectedIndex, btnElement) {
Â  Â  Â  Â  Â  Â  if (!state.isPlaying || btnElement.classList.contains('disabled')) return;

Â  Â  Â  Â  Â  Â  const buttons = document.querySelectorAll('.option-btn');
Â  Â  Â  Â  Â  Â  buttons.forEach(b => b.classList.add('disabled'));
Â  Â  Â  Â  Â  Â  const isCorrect = selectedIndex === state.currentQuestion.correctIndex;
Â  Â  Â  Â  Â  Â  const reactionTime = (Date.now() - state.questionStartTime) / 1000;

Â  Â  Â  Â  Â  Â  if (isCorrect) {
Â  Â  Â  Â  Â  Â  Â  Â  btnElement.classList.add('correct');
Â  Â  Â  Â  Â  Â  Â  Â  sound.playCorrect();
Â  Â  Â  Â  Â  Â  Â  Â  handleCorrectAnswer(reactionTime);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  btnElement.classList.add('wrong');
Â  Â  Â  Â  Â  Â  Â  Â  buttons[state.currentQuestion.correctIndex].classList.add('correct');
Â  Â  Â  Â  Â  Â  Â  Â  sound.playWrong();
Â  Â  Â  Â  Â  Â  Â  Â  handleWrongAnswer();
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  state.questionInStageIndex++; // Move next
Â  Â  Â  Â  Â  Â  checkAchievements();

Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  if (state.isPlaying) renderQuestion();
Â  Â  Â  Â  Â  Â  }, 1500);
Â  Â  Â  Â  }

Â  Â  Â  Â  function handleCorrectAnswer(reactionTime) {
Â  Â  Â  Â  Â  Â  state.totalCorrect++;
Â  Â  Â  Â  Â  Â  state.streak++;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Checking for Phoenix achievement (recovery from low time)
Â  Â  Â  Â  Â  Â  if (state.timeLeft < 5) {
Â  Â  Â  Â  Â  Â  Â  Â  state.lowTimeFlag = true;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (state.lowTimeFlag && state.timeLeft > 30) {
Â  Â  Â  Â  Â  Â  Â  Â  unlockAchievement('phoenix');
Â  Â  Â  Â  Â  Â  Â  Â  state.lowTimeFlag = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let moneyReward = Math.floor(GAME_CONFIG.baseMoney * Math.pow(GAME_CONFIG.moneyMultiplier, (state.stage - 1)));
Â  Â  Â  Â  Â  Â  let timeBonus = Math.max(2, GAME_CONFIG.timeBonusBase - (state.stage * 0.5));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let isSpeedRun = false;
Â  Â  Â  Â  Â  Â  if (reactionTime < 2) {
Â  Â  Â  Â  Â  Â  Â  Â  isSpeedRun = true;
Â  Â  Â  Â  Â  Â  Â  Â  moneyReward = Math.floor(moneyReward * 1.5);
Â  Â  Â  Â  Â  Â  Â  Â  timeBonus += 2;
Â  Â  Â  Â  Â  Â  Â  Â  sound.playSpeedBonus();
Â  Â  Â  Â  Â  Â  Â  Â  showFloatingText("âš¡ SPEED RUN! âš¡", 'general', "#ffeb3b");
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (state.streak >= 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â moneyReward += (state.streak * 10);
Â  Â  Â  Â  Â  Â  Â  Â  Â showFloatingText(`${state.streak} ×‘×¨×¦×£! ğŸ”¥`, 'general', "#ff5722");
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  state.score += moneyReward;
Â  Â  Â  Â  Â  Â  state.timeLeft += timeBonus;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  showFloatingText(`+â‚ª${moneyReward}`, 'money', 'var(--success)');
Â  Â  Â  Â  Â  Â  showFloatingText(`+${timeBonus.toFixed(1)}s`, 'time', 'var(--secondary)');

Â  Â  Â  Â  Â  Â  if (state.streak % 5 === 0 || isSpeedRun) {
Â  Â  Â  Â  Â  Â  Â  Â  confetti({ particleCount: 50, spread: 60, origin: { y: 0.8 }, colors: ['#7000ff', '#00f0ff'] });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function handleWrongAnswer() {
Â  Â  Â  Â  Â  Â  state.streak = 0;
Â  Â  Â  Â  Â  Â  const timePenalty = GAME_CONFIG.timePenaltyBase;
Â  Â  Â  Â  Â  Â  state.timeLeft -= timePenalty;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  showFloatingText(`-${timePenalty}s`, 'time', 'var(--danger)');
Â  Â  Â  Â  Â  Â  showFloatingText("××•×¤×¡! ğŸ˜¬", 'general', "#ffcc00");
Â  Â  Â  Â  }

Â  Â  Â  Â  function showFloatingText(text, type, color) {
Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  el.className = 'float-text';
Â  Â  Â  Â  Â  Â  el.textContent = text;
Â  Â  Â  Â  Â  Â  el.style.color = color;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (type === 'money') {
Â  Â  Â  Â  Â  Â  Â  Â  el.style.left = '20px';
Â  Â  Â  Â  Â  Â  Â  Â  el.style.top = '100px';Â 
Â  Â  Â  Â  Â  Â  Â  Â  el.classList.add('float-up');
Â  Â  Â  Â  Â  Â  Â  Â  el.style.fontSize = '1.5rem';
Â  Â  Â  Â  Â  Â  } else if (type === 'time') {
Â  Â  Â  Â  Â  Â  Â  Â  el.style.right = '20px';Â 
Â  Â  Â  Â  Â  Â  Â  Â  el.style.top = '100px';Â 
Â  Â  Â  Â  Â  Â  Â  Â  el.classList.add('float-up');
Â  Â  Â  Â  Â  Â  Â  Â  el.style.fontSize = '1.5rem';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  el.style.left = '50%';
Â  Â  Â  Â  Â  Â  Â  Â  el.style.top = '50%';
Â  Â  Â  Â  Â  Â  Â  Â  el.classList.add('float-center');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  document.body.appendChild(el);
Â  Â  Â  Â  Â  Â  setTimeout(() => el.remove(), 2000);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- 5. LIFELINES, AI & SHOP ---

Â  Â  Â  Â  function useLifeline(type) {
Â  Â  Â  Â  Â  Â  if (!state.isPlaying || state.lifelines[type] <= 0) return;

Â  Â  Â  Â  Â  Â  const btn = document.querySelector(`#btn-${type}`);
Â  Â  Â  Â  Â  Â  state.lifelines[type]--;
Â  Â  Â  Â  Â  Â  btn.querySelector('.lifeline-badge').textContent = '0';
Â  Â  Â  Â  Â  Â  btn.disabled = true;
Â  Â  Â  Â  Â  Â  btn.style.opacity = '0.5';

Â  Â  Â  Â  Â  Â  if (type === '5050') {
Â  Â  Â  Â  Â  Â  Â  Â  const correctIdx = state.currentQuestion.correctIndex;
Â  Â  Â  Â  Â  Â  Â  Â  const buttons = document.querySelectorAll('.option-btn');
Â  Â  Â  Â  Â  Â  Â  Â  const wrongIndices = [];
Â  Â  Â  Â  Â  Â  Â  Â  buttons.forEach((_, i) => { if(i !== correctIdx) wrongIndices.push(i); });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  for (let i = wrongIndices.length - 1; i > 0; i--) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const j = Math.floor(Math.random() * (i + 1));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [wrongIndices[i], wrongIndices[j]] = [wrongIndices[j], wrongIndices[i]];
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  buttons[wrongIndices[0]].style.visibility = 'hidden';
Â  Â  Â  Â  Â  Â  Â  Â  buttons[wrongIndices[1]].style.visibility = 'hidden';

Â  Â  Â  Â  Â  Â  } else if (type === 'freeze') {
Â  Â  Â  Â  Â  Â  Â  Â  state.isFrozen = true;
Â  Â  Â  Â  Â  Â  Â  Â  document.body.style.filter = "grayscale(80%)";
Â  Â  Â  Â  Â  Â  Â  Â  showFloatingText("×”×–××Ÿ ×§×¤×! â„ï¸", 'general', "var(--secondary)");
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.isFrozen = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.style.filter = "none";
Â  Â  Â  Â  Â  Â  Â  Â  }, 5000);Â 

Â  Â  Â  Â  Â  Â  } else if (type === 'ai') {
Â  Â  Â  Â  Â  Â  Â  Â  const bubble = document.getElementById('ai-bubble');
Â  Â  Â  Â  Â  Â  Â  Â  const correctIdx = state.currentQuestion.correctIndex;
Â  Â  Â  Â  Â  Â  Â  Â  const correctTxt = state.currentQuestion.options[correctIdx];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const confidence = Math.floor(Math.random() * (95 - 60) + 60);Â 
Â  Â  Â  Â  Â  Â  Â  Â  let aiText = "";
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (confidence > 80) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â aiText = `ğŸ¤– Gemini: "×× ×™ ${confidence}% ×‘×˜×•×— ×©×–×” <b>${correctTxt}</b>."`;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let wrongIdx = (correctIdx + 1) % 4;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let wrongTxt = state.currentQuestion.options[wrongIdx];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aiText = `ğŸ¤– Gemini: "××ª×œ×‘×˜ ×‘×™×Ÿ ${wrongTxt} ×œ-${correctTxt}... ××‘×œ ×”×•×œ×š ×¢×œ <b>${correctTxt}</b> (${confidence}%)"`;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  bubble.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  bubble.innerHTML = aiText;
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { bubble.style.display = 'none'; }, 6000);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- SHOP LOGIC ---
Â  Â  Â  Â  function getShopPrice(type) {
Â  Â  Â  Â  Â  Â  const s = state.stage;
Â  Â  Â  Â  Â  Â  const base = GAME_CONFIG.baseShopPrices;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Logic: Base Price + (Stage * Multiplier)
Â  Â  Â  Â  Â  Â  if (type === 'time_small') return base.time_small + ((s - 1) * 50);Â 
Â  Â  Â  Â  Â  Â  if (type === 'time_big') return base.time_big + ((s - 1) * 100);
Â  Â  Â  Â  Â  Â  if (type === 'lifelines') return base.lifelines + ((s - 1) * 200);
Â  Â  Â  Â  Â  Â  return 9999;
Â  Â  Â  Â  }

Â  Â  Â  Â  function openShop() {
Â  Â  Â  Â  Â  Â  if (!state.isPlaying) return;
Â  Â  Â  Â  Â  Â  state.isShopOpen = true;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Update prices in UI
Â  Â  Â  Â  Â  Â  document.getElementById('shop-price-time-small').textContent = `â‚ª${getShopPrice('time_small')}`;
Â  Â  Â  Â  Â  Â  document.getElementById('shop-price-time-big').textContent = `â‚ª${getShopPrice('time_big')}`;
Â  Â  Â  Â  Â  Â  document.getElementById('shop-price-lifelines').textContent = `â‚ª${getShopPrice('lifelines')}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('shop-modal').classList.add('active');
Â  Â  Â  Â  }

Â  Â  Â  Â  function closeShop() {
Â  Â  Â  Â  Â  Â  document.getElementById('shop-modal').classList.remove('active');
Â  Â  Â  Â  Â  Â  state.isShopOpen = false;Â 
Â  Â  Â  Â  Â  Â  state.lastFrameTime = performance.now();Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function buyItem(type) {
Â  Â  Â  Â  Â  Â  const price = getShopPrice(type);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (state.score >= price) {
Â  Â  Â  Â  Â  Â  Â  Â  state.score -= price;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (type === 'time_small') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.timeLeft += 10;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatingText("+10s", 'time', 'var(--success)');
Â  Â  Â  Â  Â  Â  Â  Â  } else if (type === 'time_big') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.timeLeft += 30;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatingText("+30s", 'time', 'var(--success)');
Â  Â  Â  Â  Â  Â  Â  Â  } else if (type === 'lifelines') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.lifelines = { '5050': 1, 'ai': 1, 'freeze': 1 };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.lifeline-btn').forEach(btn => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.style.opacity = '1';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.querySelector('.lifeline-badge').textContent = '1';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatingText("×¢×–×¨×•×ª ××œ××•×ª!", 'general', 'var(--primary)');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  sound.playCash();
Â  Â  Â  Â  Â  Â  Â  Â  unlockAchievement('spender');
Â  Â  Â  Â  Â  Â  Â  Â  updateHUD();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Recalculate price for next time immediately just in case (though it only changes on stage up)
Â  Â  Â  Â  Â  Â  Â  Â  // Actually price changes per stage, so we don't need to update TEXT here, it updates on openShop.
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const btn = event.currentTarget;
Â  Â  Â  Â  Â  Â  Â  Â  const originalBg = btn.style.background;
Â  Â  Â  Â  Â  Â  Â  Â  btn.style.background = "var(--success)";
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => btn.style.background = originalBg, 200);

Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  sound.playWrong();
Â  Â  Â  Â  Â  Â  Â  Â  showFloatingText("××™×Ÿ ××¡×¤×™×§ ×›×¡×£!", 'money', 'var(--danger)');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- 6. LEADERBOARD & MODAL & INSTRUCTIONS ---

Â  Â  Â  Â  function openLeaderboard() {
Â  Â  Â  Â  Â  Â  const modal = document.getElementById('leaderboard-modal');
Â  Â  Â  Â  Â  Â  const content = document.getElementById('modal-body-content');
Â  Â  Â  Â  Â  Â  modal.classList.add('active');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('modal-title').textContent = 'ğŸ† ×˜×‘×œ×ª ××œ×•×¤×™×';
Â  Â  Â  Â  Â  Â  document.getElementById('modal-back-btn').style.display = 'none';

Â  Â  Â  Â  Â  Â  let highScores = JSON.parse(localStorage.getItem('triviaRushScores')) || [];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  Â  Â  if (highScores.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  html = '<p style="text-align:center; opacity:0.6;">×¢×“×™×™×Ÿ ××™×Ÿ ×©×™××™×...</p>';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  html += '<div style="font-size:0.8rem; color:gray; margin-bottom:10px; text-align:right;">×œ×—×¥ ×¢×œ ×©×—×§×Ÿ ×œ×¤×™×¨×•×˜</div>';
Â  Â  Â  Â  Â  Â  Â  Â  highScores.forEach((s, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Fallback for old saves without stage
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const stage = s.stage || '?';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="leaderboard-item" onclick="showPlayerDetails(${i})">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="flex:1;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-weight:bold; color:var(--secondary);">${i+1}. ${s.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.75rem; color:#aaa;">${s.date}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align:left;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="color:var(--success); font-weight:bold;">â‚ª${s.score.toLocaleString()}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.8rem;">×©×œ×‘ ${stage}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  content.innerHTML = html;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function showPlayerDetails(index) {
Â  Â  Â  Â  Â  Â  let highScores = JSON.parse(localStorage.getItem('triviaRushScores')) || [];
Â  Â  Â  Â  Â  Â  const player = highScores[index];
Â  Â  Â  Â  Â  Â  if (!player) return;

Â  Â  Â  Â  Â  Â  document.getElementById('modal-title').textContent = `ğŸ‘¤ ×¤×¨×•×¤×™×œ: ${player.name}`;
Â  Â  Â  Â  Â  Â  document.getElementById('modal-back-btn').style.display = 'block';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const content = document.getElementById('modal-body-content');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let achievementsHtml = '';
Â  Â  Â  Â  Â  Â  const playerAchievements = player.achievements || []; // List of IDs

Â  Â  Â  Â  Â  Â  ACHIEVEMENTS_LIST.forEach(ach => {
Â  Â  Â  Â  Â  Â  Â  Â  const isUnlocked = playerAchievements.includes(ach.id);
Â  Â  Â  Â  Â  Â  Â  Â  const cls = isUnlocked ? 'unlocked' : '';
Â  Â  Â  Â  Â  Â  Â  Â  const icon = isUnlocked ? ach.icon : 'ğŸ”’';
Â  Â  Â  Â  Â  Â  Â  Â  const opacity = isUnlocked ? '1' : '0.3';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  achievementsHtml += `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="achievement-item ${cls}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="achievement-icon" style="opacity:${opacity}">${icon}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:bold; opacity:${opacity}">${ach.title}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.8rem; opacity:0.7;">${ach.desc}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  content.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align:center; margin-bottom:20px; padding:10px; background:rgba(255,255,255,0.05); border-radius:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:2rem; color:var(--success);">â‚ª${player.score.toLocaleString()}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:center; gap:20px; margin-top:5px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>×©×œ×‘: <b>${player.stage || '?'}</b></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>×”×™×©×’×™×: <b>${playerAchievements.length}</b></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <h3>×”×™×©×’×™× ×‘××©×—×§ ×–×”:</h3>
Â  Â  Â  Â  Â  Â  Â  Â  ${achievementsHtml}
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function backToLeaderboard() {
Â  Â  Â  Â  Â  Â  openLeaderboard();
Â  Â  Â  Â  }

Â  Â  Â  Â  function closeModal(id) {
Â  Â  Â  Â  Â  Â  document.getElementById(id).classList.remove('active');
Â  Â  Â  Â  }

Â  Â  Â  Â  function openInstructions() {
Â  Â  Â  Â  Â  Â  document.getElementById('instructions-modal').classList.add('active');
Â  Â  Â  Â  }

Â  Â  Â  Â  function gameOver(reason) {
Â  Â  Â  Â  Â  Â  state.isPlaying = false;
Â  Â  Â  Â  Â  Â  sound.playWin();Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('gameover-reason').textContent = reason;
Â  Â  Â  Â  Â  Â  document.getElementById('final-name').textContent = state.playerName;
Â  Â  Â  Â  Â  Â  document.getElementById('final-score').textContent = `â‚ª${state.score.toLocaleString()}`;
Â  Â  Â  Â  Â  Â  document.getElementById('final-stage').textContent = state.stage;
Â  Â  Â  Â  Â  Â  document.getElementById('final-correct').textContent = state.totalCorrect;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  saveHighScore(state.score);
Â  Â  Â  Â  Â  Â  switchScreen('gameover-screen');
Â  Â  Â  Â  }

Â  Â  Â  Â  function saveHighScore(score) {
Â  Â  Â  Â  Â  Â  let highScores = JSON.parse(localStorage.getItem('triviaRushScores')) || [];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Save richer data object
Â  Â  Â  Â  Â  Â  highScores.push({Â 
Â  Â  Â  Â  Â  Â  Â  Â  name: state.playerName,Â 
Â  Â  Â  Â  Â  Â  Â  Â  date: new Date().toLocaleDateString(),Â 
Â  Â  Â  Â  Â  Â  Â  Â  score: score,
Â  Â  Â  Â  Â  Â  Â  Â  stage: state.stage,
Â  Â  Â  Â  Â  Â  Â  Â  achievements: [...state.unlockedAchievements] // Copy array
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  highScores.sort((a, b) => b.score - a.score);
Â  Â  Â  Â  Â  Â  highScores = highScores.slice(0, 10); // Expanded top 10
Â  Â  Â  Â  Â  Â  localStorage.setItem('triviaRushScores', JSON.stringify(highScores));
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- 7. UTILS ---

Â  Â  Â  Â  function switchScreen(id) {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
Â  Â  Â  Â  Â  Â  document.getElementById(id).classList.add('active');
Â  Â  Â  Â  }

Â  Â  Â  Â  function returnToMenu() {
Â  Â  Â  Â  Â  Â  switchScreen('menu-screen');
Â  Â  Â  Â  }

Â  Â  Â  Â  // Init
Â  Â  Â  Â  window.onload = initGame;

Â  Â  </script>
</body>
</html>
